<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>HTTP Client</title>
  
  <meta name="author" content="http4s contributors"/>
  
  <meta name="author" content="Ross A. Baker"/>
  
  <meta name="author" content="Bjørn Madsen"/>
  
  <meta name="author" content="André Rouel"/>
  
  <meta name="author" content="Brad Fritz"/>
  
  <meta name="author" content="Bryce L. Anderson"/>
  
  <meta name="author" content="Ivan Porto Carrero"/>
  
  <meta name="author" content="Carlos Encarnacion"/>
  
  <meta name="author" content="Christopher Davenport"/>
  
  <meta name="author" content="Carlos Quiroz"/>
  
  <meta name="author" content="Heikki Vesalainen"/>
  
  <meta name="author" content="Paulo Siqueira"/>
  
  <meta name="author" content="Jean-Rémi Desjardins"/>
  
  <meta name="author" content="Jose Cardona"/>
  
  <meta name="author" content="Julien Truffaut"/>
  
  <meta name="author" content="Rodolfo Hansen"/>
  
  <meta name="author" content="Simon Hafner"/>
  
  <meta name="author" content="Arya Irani"/>
  
  <meta name="author" content="Ross A. Baker"/>
  
  <meta name="author" content="Sheng Chen"/>
  
  <meta name="author" content="Fabio Labella"/>
  
  
  <meta name="description" content="Documentation for http4s"/>
  
  
  
  <link rel="icon"  type="image/svg+xml" href="../../images/http4s-favicon.svg"/>
  
  <link rel="icon" sizes="32x32" type="image/png" href="../../images/http4s-favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../styles/styles.css" />
  <script src="../../helium/site/laika-helium.js"></script>
    <script src="../../helium/site/laika-versions.js"></script>
  <script>initVersions("../../", "/docs/client.html", "v0.23", null);</script>
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    <div class="menu-container version-menu">
      <a class="text-link menu-toggle" href="#">Version 0.23</a>
      <nav class="menu-content">
        <ul class="nav-list">
          <li class="level1 nav-leaf"><a href="../../versions.html">Help me choose...</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <a class="image-link" href="https://http4s.org"><img src="../../images/http4s-logo-text-dark.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/http4s/http4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/http4s/http4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../versions.html">Versions</a></li>
    <li class="level1 nav-leaf"><a href="../../changelog.html">Changelog</a></li>
    <li class="level1 nav-leaf"><a href="../../getting-help.html">Getting Help</a></li>
    <li class="level1 nav-leaf"><a href="../../contributing.html">Contributing</a></li>
    <li class="level1 nav-leaf"><a href="../../adopters.html">Adopters</a></li>
    <li class="level1 nav-leaf"><a href="../../code-of-conduct.html">Code of Conduct</a></li>
    <li class="level1 nav-leaf"><a href="../../further-reading.html">Further Reading</a></li>
    <li class="level1 nav-header">User Guide</li>
    <li class="level2 nav-leaf"><a href="quickstart.html">Quick Start</a></li>
    <li class="level2 nav-leaf"><a href="integrations.html">Integrations</a></li>
    <li class="level2 nav-leaf"><a href="upgrading.html">Upgrading</a></li>
    <li class="level2 nav-leaf"><a href="service.html">Service</a></li>
    <li class="level2 nav-leaf"><a href="dsl.html">The http4s DSL</a></li>
    <li class="level2 nav-leaf"><a href="middleware.html">Middleware</a></li>
    <li class="level2 nav-leaf"><a href="server-middleware.html">Server Middleware</a></li>
    <li class="level2 nav-leaf"><a href="client-middleware.html">Client Middleware</a></li>
    <li class="level2 nav-leaf"><a href="auth.html">Authentication</a></li>
    <li class="level2 nav-leaf"><a href="cors.html">CORS</a></li>
    <li class="level2 nav-leaf"><a href="csrf.html">CSRF</a></li>
    <li class="level2 nav-leaf"><a href="gzip.html">GZip Compression</a></li>
    <li class="level2 nav-leaf"><a href="hsts.html">HSTS</a></li>
    <li class="level2 nav-leaf"><a href="static.html">Static Files</a></li>
    <li class="level2 active nav-leaf"><a href="#">HTTP Client</a></li>
    <li class="level2 nav-leaf"><a href="entity.html">Entity Handling</a></li>
    <li class="level2 nav-leaf"><a href="streaming.html">Streaming</a></li>
    <li class="level2 nav-leaf"><a href="json.html">JSON Handling</a></li>
    <li class="level2 nav-leaf"><a href="testing.html">Testing</a></li>
    <li class="level2 nav-leaf"><a href="uri.html">URI Handling</a></li>
    <li class="level2 nav-leaf"><a href="deployment.html">Deployment</a></li>
    <li class="level2 nav-leaf"><a href="methods.html">HTTP Methods</a></li>
    <li class="level2 nav-leaf"><a href="multipart.html">Multipart and Form Handling</a></li>
    <li class="level2 nav-leaf"><a href="error-handling.html">Error Handling</a></li>
    <li class="level1 nav-header">Related Projects</li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/blaze">blaze</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-armeria">http4s-armeria</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-curl/">http4s-curl</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-dom/">http4s-dom</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-finagle/docs/">http4s-finagle</a></li>
    <li class="level2 nav-leaf"><a href="https://jdk-http-client.http4s.org/">http4s-jdk-http-client</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-jetty/">http4s-jetty</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-netty/">http4s-netty</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-servlet/">http4s-servlet</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/rho/">rho</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-boopickle/">http4s-boopickle</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-fabric/">http4s-fabric</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-fs2-data/">http4s-fs2-data</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-scala-xml/">http4s-scala-xml</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-prometheus-metrics/">http4s-prometheus-metrics</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-scalatags/">http4s-scalatags</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-session/">http4s-session</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-twirl/">http4s-twirl</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/sbt-http4s-org/">sbt-http4s-org</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/typelevel/feral/">feral</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">HTTP Client</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#setup">Setup</a></li>
    <li class="level1 nav-node"><a href="#making-requests">Making Requests</a></li>
    <li class="level2 nav-leaf"><a href="#creating-the-client">Creating the client</a></li>
    <li class="level2 nav-leaf"><a href="#describing-a-request">Describing a Request</a></li>
    <li class="level2 nav-leaf"><a href="#running-a-request">Running a Request</a></li>
    <li class="level1 nav-leaf"><a href="#constructing-a-uri">Constructing a URI</a></li>
    <li class="level1 nav-node"><a href="#middleware">Middleware</a></li>
    <li class="level2 nav-leaf"><a href="#included-middleware">Included Middleware</a></li>
    <li class="level2 nav-leaf"><a href="#metrics-middleware">Metrics Middleware</a></li>
    <li class="level1 nav-node"><a href="#examples">Examples</a></li>
    <li class="level2 nav-leaf"><a href="#send-a-get-request">Send a GET request</a></li>
    <li class="level2 nav-leaf"><a href="#send-a-post-request">Send a POST request</a></li>
    <li class="level1 nav-leaf"><a href="#calls-to-a-json-api">Calls to a JSON API</a></li>
    <li class="level1 nav-leaf"><a href="#body-decoding-encoding">Body decoding / encoding</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="http-client" class="title">HTTP Client</h1>
        <p>The <code>Client</code> trait in http4s can submit a <code>Request</code> to a server and return a <code>Response</code>.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Client</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]] {

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">run</span><span>(</span><span class="identifier">req</span><span>: </span><span class="type-name">Request</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Resource</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Response</span><span>[</span><span class="type-name">F</span><span>]]

  </span><span class="comment">//...
</span><span>}</span></code></pre>
        <p>While <code>Client</code> is abstract in its effect type <code>F</code>, we will use concrete <code>IO</code> throughout this guide.</p>
        <p>Let&#39;s briefly chat about the <code>Resource</code> wrapping the return type.
        Every request/response pair is transmitted over a connection, which is a finite resource.
        When you are done reading the <code>Response</code>, you return from the <code>Resource</code>.
        This releases the connection so that it may be re-used by another request/response pair, or shutdown.</p>
        <p>Here&#39;s a quick example app to print the response of a GET request.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.{</span><span class="type-name">IO</span><span>, </span><span class="type-name">IOApp</span><span>}
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">ember</span><span>.</span><span class="identifier">client</span><span>.</span><span class="type-name">EmberClientBuilder</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">client</span><span>.</span><span class="type-name">Client</span><span>

</span><span class="keyword">object</span><span> </span><span class="type-name">Hello</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">IOApp</span><span>.</span><span class="type-name">Simple</span><span> {

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">printHello</span><span>(</span><span class="identifier">client</span><span>: </span><span class="type-name">Client</span><span>[</span><span class="type-name">IO</span><span>]): </span><span class="type-name">IO</span><span>[</span><span class="type-name">Unit</span><span>] =
    </span><span class="identifier">client</span><span>
      .</span><span class="identifier">expect</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;http://localhost:8080/hello/Ember&quot;</span><span>)
      .</span><span class="identifier">flatMap</span><span>(</span><span class="type-name">IO</span><span>.</span><span class="identifier">println</span><span>)

  </span><span class="keyword">val</span><span> </span><span class="identifier">run</span><span>: </span><span class="type-name">IO</span><span>[</span><span class="type-name">Unit</span><span>] = </span><span class="type-name">EmberClientBuilder</span><span>
    .</span><span class="keyword">default</span><span>[</span><span class="type-name">IO</span><span>]
    .</span><span class="identifier">build</span><span>
    .</span><span class="identifier">use</span><span>(</span><span class="identifier">client</span><span> =&gt; </span><span class="identifier">printHello</span><span>(</span><span class="identifier">client</span><span>))

}</span></code></pre>
        
        <h2 id="setup" class="section"><a class="anchor-link left" href="#setup"><i class="icofont-laika link">&#xef71;</i></a>Setup</h2>
        <p>In order to play with a <code>Client</code> we&#39;ll first create an http4s <code>Server</code>.</p>
        <p>Ensure you have the following dependencies in your build.sbt:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">scalaVersion</span><span> := </span><span class="string-literal">&quot;2.13.16&quot;</span><span> </span><span class="comment">// Also supports 2.12.x and 3.x
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">http4sVersion</span><span> = </span><span class="string-literal">&quot;0.23.30&quot;</span><span>

</span><span class="identifier">libraryDependencies</span><span> ++= </span><span class="type-name">Seq</span><span>(
  </span><span class="string-literal">&quot;org.http4s&quot;</span><span> %% </span><span class="string-literal">&quot;http4s-ember-client&quot;</span><span> % </span><span class="identifier">http4sVersion</span><span>,
  </span><span class="string-literal">&quot;org.http4s&quot;</span><span> %% </span><span class="string-literal">&quot;http4s-ember-server&quot;</span><span> % </span><span class="identifier">http4sVersion</span><span>,
  </span><span class="string-literal">&quot;org.http4s&quot;</span><span> %% </span><span class="string-literal">&quot;http4s-dsl&quot;</span><span>          % </span><span class="identifier">http4sVersion</span><span>,
)</span></code></pre>
        <p>Now we can finish setting up our server:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">com</span><span>.</span><span class="identifier">comcast</span><span>.</span><span class="identifier">ip4s</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">dsl</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">ember</span><span>.</span><span class="identifier">server</span><span>.</span><span class="type-name">EmberServerBuilder</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">server</span><span>.</span><span class="identifier">middleware</span><span>.</span><span class="type-name">Logger</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">app</span><span> = </span><span class="type-name">HttpRoutes</span><span>.</span><span class="identifier">of</span><span>[</span><span class="type-name">IO</span><span>] {
  </span><span class="keyword">case</span><span> </span><span class="type-name">GET</span><span> -&gt; </span><span class="type-name">Root</span><span> / </span><span class="string-literal">&quot;hello&quot;</span><span> / </span><span class="identifier">name</span><span> =&gt;
    </span><span class="type-name">Ok</span><span>(</span><span class="string-literal">s&quot;Hello, </span><span class="substitution">$name</span><span class="string-literal">.&quot;</span><span>)
}.</span><span class="identifier">orNotFound</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">finalHttpApp</span><span> = </span><span class="type-name">Logger</span><span>.</span><span class="identifier">httpApp</span><span>(</span><span class="boolean-literal">true</span><span>, </span><span class="boolean-literal">true</span><span>)(</span><span class="identifier">app</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">server</span><span> = </span><span class="type-name">EmberServerBuilder</span><span>
  .</span><span class="keyword">default</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">withHost</span><span>(</span><span class="identifier">ipv4</span><span class="string-literal">&quot;0.0.0.0&quot;</span><span>)
  .</span><span class="identifier">withPort</span><span>(</span><span class="string-literal">port&quot;8080&quot;</span><span>)
  .</span><span class="identifier">withHttpApp</span><span>(</span><span class="identifier">finalHttpApp</span><span>)
  .</span><span class="identifier">build</span></code></pre>
        <div class="callout info">
          <i class="icofont-laika info">&#xef4e;</i>
          <p>Because this documentation is running in <a href="https://scalameta.org/mdoc/">mdoc</a> we need an implicit <code>IORuntime</code> to let us run our <code>IO</code> values explicitly with <code>.unsafeRunSync()</code>.
          In real code you should construct your whole program in <code>IO</code> and assign it to <code>run</code> in <code>IOApp</code> as in the example above.</p>
          <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">unsafe</span><span>.</span><span class="type-name">IORuntime</span><span>
</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">runtime</span><span>: </span><span class="type-name">IORuntime</span><span> = </span><span class="type-name">IORuntime</span><span>.</span><span class="identifier">global</span></code></pre>
          <p>If you are following along in a REPL you will need to start the server in the background.
          Additionally you will want a way to shutdown the server when you&#39;re done.</p>
          <p>You can do this by starting the server like so:</p>
          <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">shutdown</span><span> = </span><span class="identifier">server</span><span>.</span><span class="identifier">allocated</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()</span><span class="number-literal">._2</span></code></pre>
          <p>Later you can call <code>shutdown.unsafeRunSync()</code> to run the server&#39;s finalizers and release resources.</p>
        </div>
        
        <h2 id="making-requests" class="section"><a class="anchor-link left" href="#making-requests"><i class="icofont-laika link">&#xef71;</i></a>Making Requests</h2>
        
        <h3 id="creating-the-client" class="section"><a class="anchor-link left" href="#creating-the-client"><i class="icofont-laika link">&#xef71;</i></a>Creating the client</h3>
        <p>A good default choice is the <code>EmberClientBuilder</code>.
        The <code>EmberClientBuilder</code> sets up a connection pool, enabling the reuse of connections for multiple requests, supports HTTP/1.x and HTTP/2, and is available for ScalaJS.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">ember</span><span>.</span><span class="identifier">client</span><span>.</span><span class="type-name">EmberClientBuilder</span><span>

</span><span class="type-name">EmberClientBuilder</span><span>
  .</span><span class="keyword">default</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">build</span><span>
  .</span><span class="identifier">use</span><span> { </span><span class="identifier">client</span><span> =&gt;
    </span><span class="comment">// use `client` here, returning an `IO`.
</span><span>    </span><span class="identifier">client</span><span>.</span><span class="identifier">expect</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;http://localhost:8080/hello/Ember&quot;</span><span>)
}</span></code></pre>
        <p>In the above example <code>.build</code> returns a <code>Resource[IO, Client]</code>.
        We use the <code>Client</code> by passing <code>use</code> a function <code>Client =&gt; IO[B]</code>.
        The result is a value that, when run, will acquire a <code>Client</code>, use it, and release it (even under cancellation or errors).</p>
        <p>Note that we generally only call <code>.build.use</code> once per application and pass around the <code>Client</code>.
        See the <a href="quickstart.html">Quick Start</a> <a href="https://github.com/http4s/http4s.g8">g8 template</a> for an example.</p>
        <p>For the remainder of this tutorial, we&#39;ll use an alternate client backend
        built on the standard <code>java.net</code> library client.  Unlike the ember
        client, it does not need to be shut down.  Like the ember-client, and
        any other http4s backend, it presents the exact same <code>Client</code>
        interface!</p>
        <p>It uses blocking I/O and is not suited for production, but it is
        highly useful in a REPL or <a href="https://scalameta.org/mdoc/">mdoc</a> documentation:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">client</span><span>.</span><span class="type-name">JavaNetClientBuilder</span><span>

</span><span class="comment">// for REPL or mdoc use only!
</span><span class="keyword">val</span><span> </span><span class="identifier">httpClient</span><span>: </span><span class="type-name">Client</span><span>[</span><span class="type-name">IO</span><span>] = </span><span class="type-name">JavaNetClientBuilder</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">create</span></code></pre>
        
        <h3 id="describing-a-request" class="section"><a class="anchor-link left" href="#describing-a-request"><i class="icofont-laika link">&#xef71;</i></a>Describing a Request</h3>
        <p>To execute a GET request, we can call <code>expect</code> with the type we expect
        and the URI we want:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">helloEmber</span><span>: </span><span class="type-name">IO</span><span>[</span><span class="type-name">String</span><span>] =
  </span><span class="identifier">httpClient</span><span>.</span><span class="identifier">expect</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">&quot;http://localhost:8080/hello/Ember&quot;</span><span>)</span></code></pre>
        <p>We don&#39;t have any output from the server yet as we have not executed the request.
        We have an <code>IO[String]</code> value, which is a description of a program that, when run,
        will send a GET request to the server, and expect a plain text <code>String</code> response.</p>
        <p>Let&#39;s build another program that makes requests in parallel to greet a
        collection of people:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="type-name">Uri</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">hello</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">IO</span><span>[</span><span class="type-name">String</span><span>] = {
  </span><span class="keyword">val</span><span> </span><span class="identifier">target</span><span> = </span><span class="string-literal">uri&quot;http://localhost:8080/hello/&quot;</span><span> / </span><span class="identifier">name</span><span>
  </span><span class="identifier">httpClient</span><span>.</span><span class="identifier">expect</span><span>[</span><span class="type-name">String</span><span>](</span><span class="identifier">target</span><span>)
}

</span><span class="keyword">val</span><span> </span><span class="identifier">inputs</span><span> = </span><span class="type-name">List</span><span>(</span><span class="string-literal">&quot;Ember&quot;</span><span>, </span><span class="string-literal">&quot;http4s&quot;</span><span>, </span><span class="string-literal">&quot;Scala&quot;</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">getGreetings</span><span>: </span><span class="type-name">IO</span><span>[</span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>]] =
  </span><span class="identifier">inputs</span><span>.</span><span class="identifier">parTraverse</span><span>(</span><span class="identifier">hello</span><span>)</span></code></pre>
        <p>We use <code>parTraverse</code> to apply <code>hello</code> to each name and collect the results into
        one <code>IO[List[String]]</code>.
        The <code>par</code> prefix (as in &quot;parallel&quot;) on <code>parTraverse</code> indicates that this
        will happen concurrently not sequentially.</p>
        
        <h3 id="running-a-request" class="section"><a class="anchor-link left" href="#running-a-request"><i class="icofont-laika link">&#xef71;</i></a>Running a Request</h3>
        <p>We have built two programs: <code>helloEmber</code> will make a single request to get a greeting for Ember,
        and <code>getGreetings</code> will make multiple concurrent requests getting multiple greetings.
        In a production application we would likely compose these programs with other programs
        up until we finally pass them to <code>run</code> in <code>IOApp</code> as seen in our intro example.</p>
        <p>Here in <a href="https://scalameta.org/mdoc/">mdoc</a>, or in a REPL, we manually run the <code>IO</code> with <code>unsafeRunSync()</code>.
        Remember, you should not do this in your applications.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">helloEmber</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res1: String = &quot;Hello, Ember.&quot;
</span><span>
</span><span class="identifier">getGreetings</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res2: List[String] = List(
//   &quot;Hello, Ember.&quot;,
//   &quot;Hello, http4s.&quot;,
//   &quot;Hello, Scala.&quot;
// )</span></code></pre>
        
        <h2 id="constructing-a-uri" class="section"><a class="anchor-link left" href="#constructing-a-uri"><i class="icofont-laika link">&#xef71;</i></a>Constructing a URI</h2>
        <p>Typically, to construct a <code>Request</code>, you use a <code>Uri</code> to represent the endpoint you
        want to access.</p>
        <p>There are a number of ways to construct a <code>Uri</code>.</p>
        <p>If you have a literal string, you can use the <code>uri</code> string interpolator:</p>
        <pre><code class="nohighlight"><span class="string-literal">uri&quot;https://my-awesome-service.com/foo/bar?wow=yeah&quot;</span><span>
</span><span class="comment">// res3: Uri = Uri(
//   scheme = Some(value = Scheme(https)),
//   authority = Some(
//     value = Authority(
//       userInfo = None,
//       host = RegName(host = my-awesome-service.com),
//       port = None
//     )
//   ),
//   path = /foo/bar,
//   query = wow=yeah,
//   fragment = None
// )</span></code></pre>
        <p>This only works with literal strings because it uses a macro to validate the URI
        format at compile-time.</p>
        <p>Otherwise, you&#39;ll need to use <code>Uri.fromString(...)</code> and handle the case where
        validation fails:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">validUri</span><span> = </span><span class="string-literal">&quot;https://my-awesome-service.com/foo/bar?wow=yeah&quot;</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">invalidUri</span><span> = </span><span class="string-literal">&quot;yeah whatever&quot;</span></code></pre>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">uri</span><span>: </span><span class="type-name">ParseResult</span><span>[</span><span class="type-name">Uri</span><span>] = </span><span class="type-name">Uri</span><span>.</span><span class="identifier">fromString</span><span>(</span><span class="identifier">validUri</span><span>)
</span><span class="comment">// uri: ParseResult[Uri] = Right(
//   value = Uri(
//     scheme = Some(value = Scheme(https)),
//     authority = Some(
//       value = Authority(
//         userInfo = None,
//         host = RegName(host = my-awesome-service.com),
//         port = None
//       )
//     ),
//     path = /foo/bar,
//     query = wow=yeah,
//     fragment = None
//   )
// )
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">parseFailure</span><span>: </span><span class="type-name">ParseResult</span><span>[</span><span class="type-name">Uri</span><span>] = </span><span class="type-name">Uri</span><span>.</span><span class="identifier">fromString</span><span>(</span><span class="identifier">invalidUri</span><span>)
</span><span class="comment">// parseFailure: ParseResult[Uri] = Left(
//   value = ParseFailure(
//     sanitized = &quot;Invalid URI&quot;,
//     details = &quot;&quot;&quot;yeah whatever
//     ^
// expectation:
// * must end the string&quot;&quot;&quot;
//   )
// )</span></code></pre>
        <p>You can also build up a URI incrementally, e.g.:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">baseUri</span><span>: </span><span class="type-name">Uri</span><span> = </span><span class="string-literal">uri&quot;http://foo.com&quot;</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">withPath</span><span>: </span><span class="type-name">Uri</span><span> = </span><span class="identifier">baseUri</span><span>.</span><span class="identifier">withPath</span><span>(</span><span class="string-literal">path&quot;/bar/baz&quot;</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">withQuery</span><span>: </span><span class="type-name">Uri</span><span> = </span><span class="identifier">withPath</span><span>.</span><span class="identifier">withQueryParam</span><span>(</span><span class="string-literal">&quot;hello&quot;</span><span>, </span><span class="string-literal">&quot;world&quot;</span><span>)</span></code></pre>
        
        <h2 id="middleware" class="section"><a class="anchor-link left" href="#middleware"><i class="icofont-laika link">&#xef71;</i></a>Middleware</h2>
        <p>Like the server <a href="middleware.html">middleware</a>, the client middleware is a wrapper around a
        <code>Client</code> that provides a means of accessing or manipulating <code>Request</code>s
        and <code>Response</code>s being sent.</p>
        <p>Consider functions from <code>Int</code> to <code>String</code>. We could create a wrapper over functions of this type,
        which would take an <code>Int =&gt; String</code> and return an <code>Int =&gt; String</code>.</p>
        <p>Such a wrapper could make the result inspect its input, do something to it,
        and call the original function with that input (or even another one).
        Then it could look at the response and also make some actions based on it.</p>
        <p>An example wrapper could look something like this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">mid</span><span>(</span><span class="identifier">f</span><span>: </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">String</span><span>): </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">String</span><span> = </span><span class="identifier">in</span><span> =&gt; {
  </span><span class="comment">// `in` is the input originally passed to the function.
</span><span>  </span><span class="comment">// We can pass it to `f` directly.
</span><span>  </span><span class="comment">// Or use it to construct a new value.
</span><span>  </span><span class="keyword">val</span><span> </span><span class="identifier">resultOfF</span><span> = </span><span class="identifier">f</span><span>(</span><span class="identifier">in</span><span> + </span><span class="number-literal">1</span><span>)

  </span><span class="comment">// `resultOfF` is the result of the function applied to the new input.
</span><span>  </span><span class="comment">// Similarly, we can return it directly, or build a new value.
</span><span>  </span><span class="string-literal">s&quot;</span><span class="substitution">$in</span><span class="string-literal"> was incremented to yield </span><span class="substitution">$resultOfF</span><span class="string-literal">&quot;</span><span>
}</span></code></pre>
        <p>If we wrap a simple function, say, one returning the String representation of a number:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">f1</span><span>: </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">String</span><span> = </span><span class="identifier">_</span><span>.</span><span class="identifier">toString</span><span>
</span><span class="comment">// f1: Int =&gt; String = &lt;function1&gt;
</span><span>
</span><span class="comment">// Here, we&#39;re applying our wrapper to `f1`. Notice that this is still a function.
</span><span class="keyword">val</span><span> </span><span class="identifier">f2</span><span>: </span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">String</span><span> = </span><span class="identifier">mid</span><span>(</span><span class="identifier">f1</span><span>)
</span><span class="comment">// f2: Int =&gt; String = &lt;function1&gt;
</span><span>
</span><span class="identifier">f1</span><span>(</span><span class="number-literal">10</span><span>)
</span><span class="comment">// res4: String = &quot;10&quot;
</span><span class="identifier">f2</span><span>(</span><span class="number-literal">10</span><span>)
</span><span class="comment">// res5: String = &quot;10 was incremented to yield 11&quot;</span></code></pre>
        <p>We see how <code>f2</code> wraps <code>f1</code> by passing an incremented argument to the original function.
        This wrapper could be considered a <strong>middleware</strong> over functions from <code>Int</code> to <code>String</code>.</p>
        <p>Recall our simplified definition of <code>Client[F]</code> - it boils down to a single abstract method:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Client</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">run</span><span>(</span><span class="identifier">request</span><span>: </span><span class="type-name">Request</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Resource</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Response</span><span>[</span><span class="type-name">F</span><span>]]
}</span></code></pre>
        <p>Knowing this, we could say a <code>Client[F]</code> is equivalent to a function from <code>Request[F]</code> to <code>Resource[F, Response[F]]</code>. In fact, given a client, we could call <code>client.run _</code> to get that function.</p>
        <p>A client middleware follows the same idea as our original middleware did: it takes a <code>Client</code> (which is a function) and returns another <code>Client</code> (which is also a function).</p>
        <p>It can see the input <code>Request[F]</code> that we pass to the client when we call it, it can modify that request, pass it to the underlying client (or any other client, really!), and do all sorts of other things, including effects - all it has to do is return a <code>Resource[F, Response[F]]</code>.</p>
        <p>The real definition of <code>Client</code> is a little more complicated because there&#39;s several more abstract methods.
        If you want to implement a client using just a function (for example, to make a middleware), consider using <code>Client.apply</code>.</p>
        <p>A simple middleware, which would add a constant header to every request and response, could look like this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">MonadCancelThrow</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">ci</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">addTestHeader</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">MonadCancelThrow</span><span>](</span><span class="identifier">underlying</span><span>: </span><span class="type-name">Client</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Client</span><span>[</span><span class="type-name">F</span><span>] = </span><span class="type-name">Client</span><span>[</span><span class="type-name">F</span><span>] { </span><span class="identifier">req</span><span> =&gt;
  </span><span class="identifier">underlying</span><span>
    .</span><span class="identifier">run</span><span>(
      </span><span class="identifier">req</span><span>.</span><span class="identifier">withHeaders</span><span>(</span><span class="type-name">Header</span><span>.</span><span class="type-name">Raw</span><span>(</span><span class="string-literal">ci&quot;X-Test-Request&quot;</span><span>, </span><span class="string-literal">&quot;test&quot;</span><span>))
    )
    .</span><span class="identifier">map</span><span>(
      </span><span class="identifier">_</span><span>.</span><span class="identifier">withHeaders</span><span>(</span><span class="type-name">Header</span><span>.</span><span class="type-name">Raw</span><span>(</span><span class="string-literal">ci&quot;X-Test-Response&quot;</span><span>, </span><span class="string-literal">&quot;test&quot;</span><span>))
    )
}</span></code></pre>
        <p>As the caller of the client you would get from this, you would see the extra header in the response.
        Similarly, every service called by the client would see an extra header in the requests.</p>
        
        <h3 id="included-middleware" class="section"><a class="anchor-link left" href="#included-middleware"><i class="icofont-laika link">&#xef71;</i></a>Included Middleware</h3>
        <p>Http4s includes some middleware Out of the Box in the <code>org.http4s.client.middleware</code>
        package. These include:</p>
        <ul>
          <li>Following of redirect responses (<a href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30//org/http4s/client/middleware/FollowRedirect$">Follow Redirect</a>)</li>
          <li>Retrying of requests (<a href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30//org/http4s/client/middleware/Retry$">Retry</a>)</li>
          <li>Metrics gathering (<a href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30//org/http4s/client/middleware/Metrics$">Metrics</a>)</li>
          <li>Logging of requests (<a href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30//org/http4s/client/middleware/RequestLogger$">Request Logger</a>)</li>
          <li>Logging of responses (<a href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30//org/http4s/client/middleware/ResponseLogger$">Response Logger</a>)</li>
          <li>Logging of requests and responses (<a href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30//org/http4s/client/middleware/Logger$">Logger</a>)</li>
        </ul>
        
        <h3 id="metrics-middleware" class="section"><a class="anchor-link left" href="#metrics-middleware"><i class="icofont-laika link">&#xef71;</i></a>Metrics Middleware</h3>
        <p>Apart from the middleware mentioned in the previous section. There is, as well,
        Out of the Box middleware for <a href="https://http4s.github.io/http4s-dropwizard-metrics/">Dropwizard</a> and <a href="https://http4s.github.io/http4s-prometheus-metrics/">Prometheus</a> metrics.</p>
        
        <h2 id="examples" class="section"><a class="anchor-link left" href="#examples"><i class="icofont-laika link">&#xef71;</i></a>Examples</h2>
        
        <h3 id="send-a-get-request" class="section"><a class="anchor-link left" href="#send-a-get-request"><i class="icofont-laika link">&#xef71;</i></a>Send a GET request</h3>
        <p>You can send a GET by calling the <code>expect</code> method on the client, passing a <code>Uri</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">httpClient</span><span>.</span><span class="identifier">expect</span><span>[</span><span class="type-name">String</span><span>](</span><span class="string-literal">uri&quot;https://google.com/&quot;</span><span>)</span></code></pre>
        <p>If you need to do something more complicated like setting request headers, you
        can build up a request object and pass that to <code>expect</code>:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="type-name">Request</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="type-name">Headers</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">headers</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="type-name">MediaType</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">request</span><span> = </span><span class="type-name">Request</span><span>[</span><span class="type-name">IO</span><span>](
  </span><span class="identifier">method</span><span> = </span><span class="type-name">Method</span><span>.</span><span class="type-name">GET</span><span>,
  </span><span class="identifier">uri</span><span> = </span><span class="string-literal">uri&quot;https://my-lovely-api.com/&quot;</span><span>,
  </span><span class="identifier">headers</span><span> = </span><span class="type-name">Headers</span><span>(
    </span><span class="type-name">Authorization</span><span>(</span><span class="type-name">Credentials</span><span>.</span><span class="type-name">Token</span><span>(</span><span class="type-name">AuthScheme</span><span>.</span><span class="type-name">Bearer</span><span>, </span><span class="string-literal">&quot;open sesame&quot;</span><span>)),
    </span><span class="type-name">Accept</span><span>(</span><span class="type-name">MediaType</span><span>.</span><span class="identifier">application</span><span>.</span><span class="identifier">json</span><span>),
  )
)

</span><span class="identifier">httpClient</span><span>.</span><span class="identifier">expect</span><span>[</span><span class="type-name">String</span><span>](</span><span class="identifier">request</span><span>)</span></code></pre>
        
        <h3 id="send-a-post-request" class="section"><a class="anchor-link left" href="#send-a-post-request"><i class="icofont-laika link">&#xef71;</i></a>Send a POST request</h3>
        <p>You can send a POST request and decode the JSON response into a case class
        by deriving an <code>EntityDecoder</code> for that case class:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">generic</span><span>.</span><span class="identifier">auto</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">AuthResponse</span><span>(</span><span class="identifier">access_token</span><span>: </span><span class="type-name">String</span><span>)

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">authResponseEntityDecoder</span><span>: </span><span class="type-name">EntityDecoder</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">AuthResponse</span><span>] = </span><span class="identifier">jsonOf</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">postRequest</span><span> = </span><span class="type-name">Request</span><span>[</span><span class="type-name">IO</span><span>](
  </span><span class="identifier">method</span><span> = </span><span class="type-name">Method</span><span>.</span><span class="type-name">POST</span><span>, 
  </span><span class="identifier">uri</span><span> = </span><span class="string-literal">uri&quot;https://my-lovely-api.com/oauth2/token&quot;</span><span>
).</span><span class="identifier">withEntity</span><span>(
  </span><span class="type-name">UrlForm</span><span>(
    </span><span class="string-literal">&quot;grant_type&quot;</span><span> -&gt; </span><span class="string-literal">&quot;client_credentials&quot;</span><span>,
    </span><span class="string-literal">&quot;client_id&quot;</span><span> -&gt; </span><span class="string-literal">&quot;my-awesome-client&quot;</span><span>,
    </span><span class="string-literal">&quot;client_secret&quot;</span><span> -&gt; </span><span class="string-literal">&quot;s3cr3t&quot;</span><span>
  )
)

</span><span class="identifier">httpClient</span><span>.</span><span class="identifier">expect</span><span>[</span><span class="type-name">AuthResponse</span><span>](</span><span class="identifier">postRequest</span><span>)</span></code></pre>
        
        <h2 id="calls-to-a-json-api" class="section"><a class="anchor-link left" href="#calls-to-a-json-api"><i class="icofont-laika link">&#xef71;</i></a>Calls to a JSON API</h2>
        <p>Take a look at <a href="json.html">json</a>.</p>
        
        <h2 id="body-decoding-encoding" class="section"><a class="anchor-link left" href="#body-decoding-encoding"><i class="icofont-laika link">&#xef71;</i></a>Body decoding / encoding</h2>
        <p>The reusable way to decode or encode a request is to write a custom <code>EntityDecoder</code>
        or <code>EntityEncoder</code>. For that topic, take a look at <a href="entity.html">entity</a>.</p>
        <p>If you prefer a more fine-grained approach, some of the methods on <code>Client</code> take a
        <code>Response[F] =&gt; F[A]</code> argument, such as <code>get</code>, which lets you add a function which
        includes the decoding functionality, but ignores the media type.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">endpoint</span><span> = </span><span class="string-literal">uri&quot;http://localhost:8080/hello/Ember&quot;</span><span>
</span><span class="identifier">httpClient</span><span>.</span><span class="identifier">get</span><span>[</span><span class="type-name">Either</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">String</span><span>]](</span><span class="identifier">endpoint</span><span>) {
  </span><span class="keyword">case</span><span> </span><span class="type-name">Status</span><span>.</span><span class="type-name">Successful</span><span>(</span><span class="identifier">r</span><span>) =&gt; </span><span class="identifier">r</span><span>.</span><span class="identifier">attemptAs</span><span>[</span><span class="type-name">String</span><span>].</span><span class="identifier">leftMap</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">message</span><span>).</span><span class="identifier">value</span><span>
  </span><span class="keyword">case</span><span> </span><span class="identifier">r</span><span> =&gt; </span><span class="identifier">r</span><span>.</span><span class="identifier">as</span><span>[</span><span class="type-name">String</span><span>]
    .</span><span class="identifier">map</span><span>(</span><span class="identifier">b</span><span> =&gt; </span><span class="type-name">Left</span><span>(</span><span class="string-literal">s&quot;Request failed with status </span><span class="substitution">${r.status.code}</span><span class="string-literal"> and body </span><span class="substitution">$b</span><span class="string-literal">&quot;</span><span>))
}</span></code></pre>
        <p>Your function has to consume the body before the returned <code>F</code> exits.
        <code>Response.body</code> yields a <code>EntityBody</code> which is a type alias for <code>Stream[F, Byte]</code>.
        It&#39;s this <code>Stream</code> that needs to be consumed within your effect <code>F</code>.</p>
        <p>Do not do this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="type-name">EntityBody</span><span>

</span><span class="comment">// response.body is not consumed within `F`
</span><span class="identifier">httpClient</span><span>.</span><span class="identifier">get</span><span>[</span><span class="type-name">EntityBody</span><span>[</span><span class="type-name">IO</span><span>]](</span><span class="string-literal">&quot;some-url&quot;</span><span>)(</span><span class="identifier">response</span><span> =&gt; </span><span class="type-name">IO</span><span>(</span><span class="identifier">response</span><span>.</span><span class="identifier">body</span><span>))</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  http4s is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>