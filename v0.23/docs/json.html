<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>JSON Handling</title>
  
  <meta name="author" content="http4s contributors"/>
  
  <meta name="author" content="Ross A. Baker"/>
  
  <meta name="author" content="Bjørn Madsen"/>
  
  <meta name="author" content="André Rouel"/>
  
  <meta name="author" content="Brad Fritz"/>
  
  <meta name="author" content="Bryce L. Anderson"/>
  
  <meta name="author" content="Ivan Porto Carrero"/>
  
  <meta name="author" content="Carlos Encarnacion"/>
  
  <meta name="author" content="Christopher Davenport"/>
  
  <meta name="author" content="Carlos Quiroz"/>
  
  <meta name="author" content="Heikki Vesalainen"/>
  
  <meta name="author" content="Paulo Siqueira"/>
  
  <meta name="author" content="Jean-Rémi Desjardins"/>
  
  <meta name="author" content="Jose Cardona"/>
  
  <meta name="author" content="Julien Truffaut"/>
  
  <meta name="author" content="Rodolfo Hansen"/>
  
  <meta name="author" content="Simon Hafner"/>
  
  <meta name="author" content="Arya Irani"/>
  
  <meta name="author" content="Ross A. Baker"/>
  
  <meta name="author" content="Sheng Chen"/>
  
  <meta name="author" content="Fabio Labella"/>
  
  
  <meta name="description" content="Documentation for http4s"/>
  
  
  
  <link rel="icon"  type="image/svg+xml" href="../../images/http4s-favicon.svg"/>
  
  <link rel="icon" sizes="32x32" type="image/png" href="../../images/http4s-favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../styles/styles.css" />
  <script src="../../helium/site/laika-helium.js"></script>
    <script src="../../helium/site/laika-versions.js"></script>
  <script>initVersions("../../", "/docs/json.html", "v0.23", null);</script>
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    <div class="menu-container version-menu">
      <a class="text-link menu-toggle" href="#">Version 0.23</a>
      <nav class="menu-content">
        <ul class="nav-list">
          <li class="level1 nav-leaf"><a href="../../versions.html">Help me choose...</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <a class="image-link" href="https://http4s.org"><img src="../../images/http4s-logo-text-dark.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/http4s/http4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/http4s/http4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../versions.html">Versions</a></li>
    <li class="level1 nav-leaf"><a href="../../changelog.html">Changelog</a></li>
    <li class="level1 nav-leaf"><a href="../../getting-help.html">Getting Help</a></li>
    <li class="level1 nav-leaf"><a href="../../contributing.html">Contributing</a></li>
    <li class="level1 nav-leaf"><a href="../../adopters.html">Adopters</a></li>
    <li class="level1 nav-leaf"><a href="../../code-of-conduct.html">Code of Conduct</a></li>
    <li class="level1 nav-leaf"><a href="../../further-reading.html">Further Reading</a></li>
    <li class="level1 nav-header">User Guide</li>
    <li class="level2 nav-leaf"><a href="quickstart.html">Quick Start</a></li>
    <li class="level2 nav-leaf"><a href="integrations.html">Integrations</a></li>
    <li class="level2 nav-leaf"><a href="upgrading.html">Upgrading</a></li>
    <li class="level2 nav-leaf"><a href="service.html">Service</a></li>
    <li class="level2 nav-leaf"><a href="dsl.html">The http4s DSL</a></li>
    <li class="level2 nav-leaf"><a href="middleware.html">Middleware</a></li>
    <li class="level2 nav-leaf"><a href="server-middleware.html">Server Middleware</a></li>
    <li class="level2 nav-leaf"><a href="client-middleware.html">Client Middleware</a></li>
    <li class="level2 nav-leaf"><a href="auth.html">Authentication</a></li>
    <li class="level2 nav-leaf"><a href="cors.html">CORS</a></li>
    <li class="level2 nav-leaf"><a href="csrf.html">CSRF</a></li>
    <li class="level2 nav-leaf"><a href="gzip.html">GZip Compression</a></li>
    <li class="level2 nav-leaf"><a href="hsts.html">HSTS</a></li>
    <li class="level2 nav-leaf"><a href="static.html">Static Files</a></li>
    <li class="level2 nav-leaf"><a href="client.html">HTTP Client</a></li>
    <li class="level2 nav-leaf"><a href="entity.html">Entity Handling</a></li>
    <li class="level2 nav-leaf"><a href="streaming.html">Streaming</a></li>
    <li class="level2 active nav-leaf"><a href="#">JSON Handling</a></li>
    <li class="level2 nav-leaf"><a href="testing.html">Testing</a></li>
    <li class="level2 nav-leaf"><a href="uri.html">URI Handling</a></li>
    <li class="level2 nav-leaf"><a href="deployment.html">Deployment</a></li>
    <li class="level2 nav-leaf"><a href="methods.html">HTTP Methods</a></li>
    <li class="level2 nav-leaf"><a href="multipart.html">Multipart and Form Handling</a></li>
    <li class="level2 nav-leaf"><a href="error-handling.html">Error Handling</a></li>
    <li class="level1 nav-header">Related Projects</li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/blaze">blaze</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-armeria">http4s-armeria</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-curl/">http4s-curl</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-dom/">http4s-dom</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-finagle/docs/">http4s-finagle</a></li>
    <li class="level2 nav-leaf"><a href="https://jdk-http-client.http4s.org/">http4s-jdk-http-client</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-jetty/">http4s-jetty</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-netty/">http4s-netty</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-servlet/">http4s-servlet</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/rho/">rho</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-boopickle/">http4s-boopickle</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-fabric/">http4s-fabric</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-fs2-data/">http4s-fs2-data</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-scala-xml/">http4s-scala-xml</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-prometheus-metrics/">http4s-prometheus-metrics</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-scalatags/">http4s-scalatags</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-session/">http4s-session</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-twirl/">http4s-twirl</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/sbt-http4s-org/">sbt-http4s-org</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/typelevel/feral/">feral</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">JSON Handling</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#add-the-json-support-module-s">Add the JSON support module(s)</a></li>
    <li class="level2 nav-leaf"><a href="#circe">Circe</a></li>
    <li class="level1 nav-leaf"><a href="#sending-raw-json">Sending Raw JSON</a></li>
    <li class="level1 nav-leaf"><a href="#encoding-case-classes-as-json">Encoding case classes as JSON</a></li>
    <li class="level1 nav-leaf"><a href="#receiving-raw-json">Receiving Raw JSON</a></li>
    <li class="level1 nav-leaf"><a href="#decoding-json-to-a-case-class">Decoding JSON to a case class</a></li>
    <li class="level1 nav-node"><a href="#putting-it-all-together">Putting it all together</a></li>
    <li class="level2 nav-leaf"><a href="#a-hello-world-service">A Hello World Service</a></li>
    <li class="level1 nav-leaf"><a href="#a-hello-world-client">A Hello World Client</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="json-handling" class="title">JSON Handling</h1>
        
        <h2 id="add-the-json-support-module-s" class="section"><a class="anchor-link left" href="#add-the-json-support-module-s"><i class="icofont-laika link">&#xef71;</i></a>Add the JSON support module(s)</h2>
        <p>http4s-core does not include JSON support, but integration with some
        popular Scala JSON libraries are supported as modules.</p>
        
        <h3 id="circe" class="section"><a class="anchor-link left" href="#circe"><i class="icofont-laika link">&#xef71;</i></a>Circe</h3>
        <p>The http4s team recommends circe.  Only http4s-circe is required for
        basic interop with circe, but to follow this tutorial, install all three:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">http4sVersion</span><span> = </span><span class="string-literal">&quot;0.23.30&quot;</span><span>

</span><span class="identifier">libraryDependencies</span><span> ++= </span><span class="type-name">Seq</span><span>(
  </span><span class="string-literal">&quot;org.http4s&quot;</span><span> %% </span><span class="string-literal">&quot;http4s-circe&quot;</span><span> % </span><span class="identifier">http4sVersion</span><span>,
  </span><span class="comment">// Optional for auto-derivation of JSON codecs
</span><span>  </span><span class="string-literal">&quot;io.circe&quot;</span><span> %% </span><span class="string-literal">&quot;circe-generic&quot;</span><span> % </span><span class="string-literal">&quot;0.14.8&quot;</span><span>,
  </span><span class="comment">// Optional for string interpolation to JSON model
</span><span>  </span><span class="string-literal">&quot;io.circe&quot;</span><span> %% </span><span class="string-literal">&quot;circe-literal&quot;</span><span> % </span><span class="string-literal">&quot;0.14.8&quot;</span><span>
)

</span><span class="identifier">addCompilerPlugin</span><span>(</span><span class="string-literal">&quot;org.scalamacros&quot;</span><span> % </span><span class="string-literal">&quot;paradise&quot;</span><span> % </span><span class="string-literal">&quot;2.1.0&quot;</span><span> </span><span class="identifier">cross</span><span> </span><span class="type-name">CrossVersion</span><span>.</span><span class="identifier">full</span><span>)</span></code></pre>
        <p>If you&#39;re in a REPL, we also need a runtime:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">unsafe</span><span>.</span><span class="type-name">IORuntime</span><span>
</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">runtime</span><span>: </span><span class="type-name">IORuntime</span><span> = </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">unsafe</span><span>.</span><span class="type-name">IORuntime</span><span>.</span><span class="identifier">global</span></code></pre>
        
        <h2 id="sending-raw-json" class="section"><a class="anchor-link left" href="#sending-raw-json"><i class="icofont-laika link">&#xef71;</i></a>Sending Raw JSON</h2>
        <p>Let&#39;s create a function to produce a simple JSON greeting with circe. First, the imports:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">literal</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">dsl</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">_</span></code></pre>
        <div class="callout info">
          <i class="icofont-laika info">&#xef4e;</i>
          <p>Under some setup options (we saw this in Scala 3.1.2 but not in 3.1.0), running <code>import io.circe._</code> might give you an error of <code>-- [E008] Not Found Error: value circe is not a member of io</code>. This means that <code>io</code> is shadowed from some other package. In that case, you should run <code>import _root_.io.circe._</code>, analogously for the other <code>circe</code> imports.</p>
        </div>
        <p>Then the actual code:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">hello</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Json</span><span> =
  </span><span class="string-literal">json&quot;&quot;&quot;{&quot;hello&quot;: </span><span class="substitution">$name</span><span class="string-literal">}&quot;&quot;&quot;</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">greeting</span><span> = </span><span class="identifier">hello</span><span>(</span><span class="string-literal">&quot;world&quot;</span><span>)
</span><span class="comment">// greeting: Json = JObject(value = object[hello -&gt; &quot;world&quot;])</span></code></pre>
        <p>We now have a JSON value, but we don&#39;t have enough to render it:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Ok</span><span>(</span><span class="identifier">greeting</span><span>).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// error: Cannot convert from io.circe.Json to an Entity, because no EntityEncoder[cats.effect.IO, io.circe.Json] instance could be found.
// Ok(greeting).unsafeRunSync()
// ^^^^^^^^^^^^</span></code></pre>
        <p>To encode a Scala value of type <code>A</code> into an entity, we need an
        <code>EntityEncoder[A]</code> in scope.  The http4s-circe module includes a
        <code>org.http4s.circe</code> object, which gives us exactly this for an
        <code>io.circe.Json</code> value:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">_</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Ok</span><span>(</span><span class="identifier">greeting</span><span>).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res1: Response[IO] = (
//    = Status(code = 200),
//    = HttpVersion(major = 1, minor = 1),
//    = Headers(Content-Type: application/json, Content-Length: 17),
//    = Stream(..),
//    = org.typelevel.vault.Vault@c03e96c
// )</span></code></pre>
        <p>The same <code>EntityEncoder[Json]</code> we use on server responses is also
        useful on client requests:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Request</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="type-name">Method</span><span>.</span><span class="type-name">POST</span><span>, </span><span class="string-literal">uri&quot;/hello&quot;</span><span>)
  .</span><span class="identifier">withEntity</span><span>(</span><span class="string-literal">json&quot;&quot;&quot;{&quot;name&quot;: &quot;Alice&quot;}&quot;&quot;&quot;</span><span>)</span></code></pre>
        
        <h2 id="encoding-case-classes-as-json" class="section"><a class="anchor-link left" href="#encoding-case-classes-as-json"><i class="icofont-laika link">&#xef71;</i></a>Encoding case classes as JSON</h2>
        <p>These JSON literals are nice, but in real apps, we prefer to operate
        on case classes and use JSON as a serialization format near the edge
        of the world.</p>
        <p>Let&#39;s define a couple case classes:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Hello</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>)
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">User</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>)</span></code></pre>
        <p>To transform a value of type <code>A</code> into <code>Json</code>, circe uses an
        <code>io.circe.Encoder[A]</code>.  With circe&#39;s syntax, we can convert any value
        to JSON as long as an implicit <code>Encoder</code> is in scope:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="type-name">HelloEncoder</span><span>: </span><span class="type-name">Encoder</span><span>[</span><span class="type-name">Hello</span><span>] =
  </span><span class="type-name">Encoder</span><span>.</span><span class="identifier">instance</span><span> { (</span><span class="identifier">hello</span><span>: </span><span class="type-name">Hello</span><span>) =&gt;
    </span><span class="string-literal">json&quot;&quot;&quot;{&quot;hello&quot;: </span><span class="substitution">${hello.name}</span><span class="string-literal">}&quot;&quot;&quot;</span><span>
  }
</span><span class="comment">// HelloEncoder: Encoder[Hello] = io.circe.Encoder$$anon$3@3c224e7b
</span><span>
</span><span class="type-name">Hello</span><span>(</span><span class="string-literal">&quot;Alice&quot;</span><span>).</span><span class="identifier">asJson</span><span>
</span><span class="comment">// res3: Json = JObject(value = object[hello -&gt; &quot;Alice&quot;])</span></code></pre>
        <p>That was easy, but gets tedious for applications dealing in lots of
        types.  Fortunately, circe can automatically derive an encoder for us,
        using the field names of the case class as key names in a JSON object:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">generic</span><span>.</span><span class="identifier">auto</span><span>.</span><span class="identifier">_</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">User</span><span>(</span><span class="string-literal">&quot;Alice&quot;</span><span>).</span><span class="identifier">asJson</span><span>
</span><span class="comment">// res4: Json = JObject(value = object[name -&gt; &quot;Alice&quot;])</span></code></pre>
        <p>Equipped with an <code>Encoder</code> and <code>.asJson</code>, we can send JSON in requests
        and responses for our case classes:</p>
        <pre><code class="nohighlight"><span class="type-name">Ok</span><span>(</span><span class="type-name">Hello</span><span>(</span><span class="string-literal">&quot;Alice&quot;</span><span>).</span><span class="identifier">asJson</span><span>).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res5: Response[IO] = (
//    = Status(code = 200),
//    = HttpVersion(major = 1, minor = 1),
//    = Headers(Content-Type: application/json, Content-Length: 17),
//    = Stream(..),
//    = org.typelevel.vault.Vault@3d05f011
// )
</span><span class="type-name">Request</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="type-name">Method</span><span>.</span><span class="type-name">POST</span><span>, </span><span class="string-literal">uri&quot;/hello&quot;</span><span>)
  .</span><span class="identifier">withEntity</span><span>(</span><span class="type-name">User</span><span>(</span><span class="string-literal">&quot;Bob&quot;</span><span>).</span><span class="identifier">asJson</span><span>)
</span><span class="comment">// res6: Request[IO] = (
//    = POST,
//    = Uri(
//     scheme = None,
//     authority = None,
//     path = /hello,
//     query = ,
//     fragment = None
//   ),
//    = HttpVersion(major = 1, minor = 1),
//    = Headers(Content-Length: 14, Content-Type: application/json),
//    = Stream(..),
//    = org.typelevel.vault.Vault@d59a82a
// )</span></code></pre>
        <p>If within some route we serve json only, we can use:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>{
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="type-name">CirceEntityEncoder</span><span>.</span><span class="identifier">_</span><span>
}</span></code></pre>
        <p>Thus there&#39;s no more need in calling <code>asJson</code> on result.
        However, it may introduce ambiguity errors when we also build
        some json by hand within the same scope.</p>
        
        <h2 id="receiving-raw-json" class="section"><a class="anchor-link left" href="#receiving-raw-json"><i class="icofont-laika link">&#xef71;</i></a>Receiving Raw JSON</h2>
        <p>Just as we needed an <code>EntityEncoder[JSON]</code> to send JSON from a server
        or client, we need an <code>EntityDecoder[JSON]</code> to receive it.</p>
        <p>The <code>org.http4s.circe._</code> package provides an implicit
        <code>EntityDecoder[Json]</code>.  This makes it very easy to decode a request or
        response body to JSON using the <a href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30//org/http4s/MessageOps.html#as[T](implicitF:cats.FlatMap[F],implicitdecoder:org.http4s.EntityDecoder[F,T]):F[T]"><code>as</code> syntax</a>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Ok</span><span>(</span><span class="string-literal">&quot;&quot;&quot;{&quot;name&quot;:&quot;Alice&quot;}&quot;&quot;&quot;</span><span>).</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">as</span><span>[</span><span class="type-name">Json</span><span>]).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res8: Json = JObject(value = object[name -&gt; &quot;Alice&quot;])
</span><span class="type-name">Request</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="type-name">Method</span><span>.</span><span class="type-name">POST</span><span>, </span><span class="string-literal">uri&quot;/hello&quot;</span><span>)
  .</span><span class="identifier">withEntity</span><span>(</span><span class="string-literal">&quot;&quot;&quot;{&quot;name&quot;:&quot;Bob&quot;}&quot;&quot;&quot;</span><span>)
  .</span><span class="identifier">as</span><span>[</span><span class="type-name">Json</span><span>].</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res9: Json = JObject(value = object[name -&gt; &quot;Bob&quot;])</span></code></pre>
        <p>Like sending raw JSON, this is useful to a point, but we typically
        want to get to a typed model as quickly as we can.</p>
        
        <h2 id="decoding-json-to-a-case-class" class="section"><a class="anchor-link left" href="#decoding-json-to-a-case-class"><i class="icofont-laika link">&#xef71;</i></a>Decoding JSON to a case class</h2>
        <p>To get from an HTTP entity to <code>Json</code>, we use an <code>EntityDecoder[Json]</code>.
        To get from <code>Json</code> to any type <code>A</code>, we need an <code>io.circe.Decoder[A]</code>.
        http4s-circe provides the <code>jsonOf</code> function to make the connection all
        the way from HTTP to your type <code>A</code>.  Specifically, <code>jsonOf[A]</code> takes
        an implicit <code>Decoder[A]</code> and makes a <code>EntityDecoder[A]</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">userDecoder</span><span>: </span><span class="type-name">EntityDecoder</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">User</span><span>] = </span><span class="identifier">jsonOf</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">User</span><span>]
</span><span class="comment">// userDecoder: EntityDecoder[IO, User] = org.http4s.EntityDecoder$$anon$2@198a4f8
</span><span class="type-name">Ok</span><span>(</span><span class="string-literal">&quot;&quot;&quot;{&quot;name&quot;:&quot;Alice&quot;}&quot;&quot;&quot;</span><span>).</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">as</span><span>[</span><span class="type-name">User</span><span>]).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res10: User = User(name = &quot;Alice&quot;)
</span><span>
</span><span class="type-name">Request</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="type-name">Method</span><span>.</span><span class="type-name">POST</span><span>, </span><span class="string-literal">uri&quot;/hello&quot;</span><span>)
  .</span><span class="identifier">withEntity</span><span>(</span><span class="string-literal">&quot;&quot;&quot;{&quot;name&quot;:&quot;Bob&quot;}&quot;&quot;&quot;</span><span>)
  .</span><span class="identifier">as</span><span>[</span><span class="type-name">User</span><span>].</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res11: User = User(name = &quot;Bob&quot;)</span></code></pre>
        <p>If we are always decoding from JSON to a typed model, we can use
        the following import:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="type-name">CirceEntityDecoder</span><span>.</span><span class="identifier">_</span></code></pre>
        <p>This creates an <code>EntityDecoder[A]</code> for every <code>A</code> that has a <code>Decoder</code> instance.</p>
        <p>However, be cautious when using this. Having this implicit
        in scope does mean that we would always try to decode HTTP entities
        from JSON (even if it is XML or plain text, for instance).</p>
        <p>For more convenience there is import combining both encoding
        and decoding derivation:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="type-name">CirceEntityCodec</span><span>.</span><span class="identifier">_</span></code></pre>
        
        <h2 id="putting-it-all-together" class="section"><a class="anchor-link left" href="#putting-it-all-together"><i class="icofont-laika link">&#xef71;</i></a>Putting it all together</h2>
        
        <h3 id="a-hello-world-service" class="section"><a class="anchor-link left" href="#a-hello-world-service"><i class="icofont-laika link">&#xef71;</i></a>A Hello World Service</h3>
        <p>Our hello world service will parse a <code>User</code> from a request and offer a
        proper greeting.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">com</span><span>.</span><span class="identifier">comcast</span><span>.</span><span class="identifier">ip4s</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">generic</span><span>.</span><span class="identifier">auto</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">dsl</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">ember</span><span>.</span><span class="identifier">server</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">scala</span><span>.</span><span class="identifier">concurrent</span><span>.</span><span class="identifier">duration</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">User</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>)
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Hello</span><span>(</span><span class="identifier">greeting</span><span>: </span><span class="type-name">String</span><span>)

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">decoder</span><span>: </span><span class="type-name">EntityDecoder</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">User</span><span>] = </span><span class="identifier">jsonOf</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">User</span><span>]

</span><span class="keyword">val</span><span> </span><span class="identifier">jsonApp</span><span> = </span><span class="type-name">HttpRoutes</span><span>.</span><span class="identifier">of</span><span>[</span><span class="type-name">IO</span><span>] {
  </span><span class="keyword">case</span><span> </span><span class="identifier">req</span><span> @ </span><span class="type-name">POST</span><span> -&gt; </span><span class="type-name">Root</span><span> / </span><span class="string-literal">&quot;hello&quot;</span><span> =&gt;
    </span><span class="keyword">for</span><span> {
	  </span><span class="comment">// Decode a User request
</span><span>	  </span><span class="identifier">user</span><span> &lt;- </span><span class="identifier">req</span><span>.</span><span class="identifier">as</span><span>[</span><span class="type-name">User</span><span>]
	  </span><span class="comment">// Encode a hello response
</span><span>	  </span><span class="identifier">resp</span><span> &lt;- </span><span class="type-name">Ok</span><span>(</span><span class="type-name">Hello</span><span>(</span><span class="identifier">user</span><span>.</span><span class="identifier">name</span><span>).</span><span class="identifier">asJson</span><span>)
    } </span><span class="keyword">yield</span><span> (</span><span class="identifier">resp</span><span>)
}.</span><span class="identifier">orNotFound</span><span>


</span><span class="keyword">val</span><span> </span><span class="identifier">server</span><span> = </span><span class="type-name">EmberServerBuilder</span><span>
  .</span><span class="keyword">default</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">withHost</span><span>(</span><span class="identifier">ipv4</span><span class="string-literal">&quot;0.0.0.0&quot;</span><span>)
  .</span><span class="identifier">withPort</span><span>(</span><span class="string-literal">port&quot;8080&quot;</span><span>)
  .</span><span class="identifier">withHttpApp</span><span>(</span><span class="identifier">jsonApp</span><span>)
  .</span><span class="identifier">build</span></code></pre>
        <p>We start a server resource in the background.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">shutdown</span><span> = </span><span class="identifier">server</span><span>.</span><span class="identifier">allocated</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()</span><span class="number-literal">._2</span></code></pre>
        
        <h2 id="a-hello-world-client" class="section"><a class="anchor-link left" href="#a-hello-world-client"><i class="icofont-laika link">&#xef71;</i></a>A Hello World Client</h2>
        <p>Now let&#39;s make a client for the service above:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">http4s</span><span>.</span><span class="identifier">ember</span><span>.</span><span class="identifier">client</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">generic</span><span>.</span><span class="identifier">auto</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">helloClient</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">IO</span><span>[</span><span class="type-name">Hello</span><span>] = {
  </span><span class="comment">// Encode a User request  
</span><span>  </span><span class="keyword">val</span><span> </span><span class="identifier">req</span><span> = </span><span class="type-name">Request</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="type-name">Method</span><span>.</span><span class="type-name">POST</span><span>, </span><span class="string-literal">uri&quot;http://localhost:8080/hello&quot;</span><span>)
    .</span><span class="identifier">withEntity</span><span>(</span><span class="type-name">User</span><span>(</span><span class="identifier">name</span><span>).</span><span class="identifier">asJson</span><span>)
  </span><span class="comment">// Create a client
</span><span>  </span><span class="comment">// Note: this client is used exactly once, and discarded
</span><span>  </span><span class="comment">// Ideally you should .build.use it once, and share it for multiple requests
</span><span>  </span><span class="type-name">EmberClientBuilder</span><span>.</span><span class="keyword">default</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">build</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">httpClient</span><span> =&gt;
    </span><span class="comment">// Decode a Hello response
</span><span>    </span><span class="identifier">httpClient</span><span>.</span><span class="identifier">expect</span><span>(</span><span class="identifier">req</span><span>)(</span><span class="identifier">jsonOf</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Hello</span><span>])
  }
}</span></code></pre>
        <p>Finally, we post <code>User(&quot;Alice&quot;)</code> to our Hello service and expect
        <code>Hello(&quot;Alice&quot;)</code> back:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">helloClient</span><span>(</span><span class="string-literal">&quot;Alice&quot;</span><span>).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res13: Hello = Hello(greeting = &quot;Alice&quot;)</span></code></pre>
        <p>Finally, shut down our example server.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">shutdown</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  http4s is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>