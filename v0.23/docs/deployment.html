<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Deployment</title>
  
  <meta name="author" content="http4s contributors"/>
  
  <meta name="author" content="Ross A. Baker"/>
  
  <meta name="author" content="Bjørn Madsen"/>
  
  <meta name="author" content="André Rouel"/>
  
  <meta name="author" content="Brad Fritz"/>
  
  <meta name="author" content="Bryce L. Anderson"/>
  
  <meta name="author" content="Ivan Porto Carrero"/>
  
  <meta name="author" content="Carlos Encarnacion"/>
  
  <meta name="author" content="Christopher Davenport"/>
  
  <meta name="author" content="Carlos Quiroz"/>
  
  <meta name="author" content="Heikki Vesalainen"/>
  
  <meta name="author" content="Paulo Siqueira"/>
  
  <meta name="author" content="Jean-Rémi Desjardins"/>
  
  <meta name="author" content="Jose Cardona"/>
  
  <meta name="author" content="Julien Truffaut"/>
  
  <meta name="author" content="Rodolfo Hansen"/>
  
  <meta name="author" content="Simon Hafner"/>
  
  <meta name="author" content="Arya Irani"/>
  
  <meta name="author" content="Ross A. Baker"/>
  
  <meta name="author" content="Sheng Chen"/>
  
  <meta name="author" content="Fabio Labella"/>
  
  
  <meta name="description" content="Documentation for http4s"/>
  
  
  
  <link rel="icon"  type="image/svg+xml" href="../../images/http4s-favicon.svg"/>
  
  <link rel="icon" sizes="32x32" type="image/png" href="../../images/http4s-favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../styles/styles.css" />
  <script src="../../helium/site/laika-helium.js"></script>
    <script src="../../helium/site/laika-versions.js"></script>
  <script>initVersions("../../", "/docs/deployment.html", "v0.23", null);</script>
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    <div class="menu-container version-menu">
      <a class="text-link menu-toggle" href="#">Version 0.23</a>
      <nav class="menu-content">
        <ul class="nav-list">
          <li class="level1 nav-leaf"><a href="../../versions.html">Help me choose...</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <a class="image-link" href="https://http4s.org"><img src="../../images/http4s-logo-text-dark.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/http4s/http4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.http4s/http4s-docs_2.13/0.23.30/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/http4s/http4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../versions.html">Versions</a></li>
    <li class="level1 nav-leaf"><a href="../../changelog.html">Changelog</a></li>
    <li class="level1 nav-leaf"><a href="../../getting-help.html">Getting Help</a></li>
    <li class="level1 nav-leaf"><a href="../../contributing.html">Contributing</a></li>
    <li class="level1 nav-leaf"><a href="../../adopters.html">Adopters</a></li>
    <li class="level1 nav-leaf"><a href="../../code-of-conduct.html">Code of Conduct</a></li>
    <li class="level1 nav-leaf"><a href="../../further-reading.html">Further Reading</a></li>
    <li class="level1 nav-header">User Guide</li>
    <li class="level2 nav-leaf"><a href="quickstart.html">Quick Start</a></li>
    <li class="level2 nav-leaf"><a href="integrations.html">Integrations</a></li>
    <li class="level2 nav-leaf"><a href="upgrading.html">Upgrading</a></li>
    <li class="level2 nav-leaf"><a href="service.html">Service</a></li>
    <li class="level2 nav-leaf"><a href="dsl.html">The http4s DSL</a></li>
    <li class="level2 nav-leaf"><a href="middleware.html">Middleware</a></li>
    <li class="level2 nav-leaf"><a href="server-middleware.html">Server Middleware</a></li>
    <li class="level2 nav-leaf"><a href="client-middleware.html">Client Middleware</a></li>
    <li class="level2 nav-leaf"><a href="auth.html">Authentication</a></li>
    <li class="level2 nav-leaf"><a href="cors.html">CORS</a></li>
    <li class="level2 nav-leaf"><a href="csrf.html">CSRF</a></li>
    <li class="level2 nav-leaf"><a href="gzip.html">GZip Compression</a></li>
    <li class="level2 nav-leaf"><a href="hsts.html">HSTS</a></li>
    <li class="level2 nav-leaf"><a href="static.html">Static Files</a></li>
    <li class="level2 nav-leaf"><a href="client.html">HTTP Client</a></li>
    <li class="level2 nav-leaf"><a href="entity.html">Entity Handling</a></li>
    <li class="level2 nav-leaf"><a href="streaming.html">Streaming</a></li>
    <li class="level2 nav-leaf"><a href="json.html">JSON Handling</a></li>
    <li class="level2 nav-leaf"><a href="testing.html">Testing</a></li>
    <li class="level2 nav-leaf"><a href="uri.html">URI Handling</a></li>
    <li class="level2 active nav-leaf"><a href="#">Deployment</a></li>
    <li class="level2 nav-leaf"><a href="error-handling.html">Error Handling</a></li>
    <li class="level2 nav-leaf"><a href="multipart.html">Multipart and Form Handling</a></li>
    <li class="level2 nav-leaf"><a href="methods.html">HTTP Methods</a></li>
    <li class="level1 nav-header">Related Projects</li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/blaze">blaze</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-armeria">http4s-armeria</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-curl/">http4s-curl</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-dom/">http4s-dom</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-finagle/docs/">http4s-finagle</a></li>
    <li class="level2 nav-leaf"><a href="https://jdk-http-client.http4s.org/">http4s-jdk-http-client</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-jetty/">http4s-jetty</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-netty/">http4s-netty</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-servlet/">http4s-servlet</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/rho/">rho</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-boopickle/">http4s-boopickle</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-fabric/">http4s-fabric</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-fs2-data/">http4s-fs2-data</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-scala-xml/">http4s-scala-xml</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-prometheus-metrics/">http4s-prometheus-metrics</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-scalatags/">http4s-scalatags</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/http4s-session/">http4s-session</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/http4s/http4s-twirl/">http4s-twirl</a></li>
    <li class="level2 nav-leaf"><a href="https://http4s.github.io/sbt-http4s-org/">sbt-http4s-org</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/typelevel/feral/">feral</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Deployment</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#overview">Overview</a></li>
    <li class="level2 nav-leaf"><a href="#assembled-jar">Assembled JAR</a></li>
    <li class="level2 nav-leaf"><a href="#graal-native-image">Graal Native Image</a></li>
    <li class="level2 nav-leaf"><a href="#optional-get-or-build-a-muslc-bundle-required-to-build-a-static-image">(Optional) Get or build a muslC bundle required to build a static image.</a></li>
    <li class="level2 nav-leaf"><a href="#meta-inf-resources-for-reflection">META-INF resources for reflection</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="deployment" class="title">Deployment</h1>
        
        <h2 id="overview" class="section"><a class="anchor-link left" href="#overview"><i class="icofont-laika link">&#xef71;</i></a>Overview</h2>
        <p>You&#39;ve built and tested your service. How can we deploy it into production? One approach is to create an assembled JAR containing the service with all its dependencies. We can then execute it via <code>java -jar</code>. Another approach would be to create a native image binary via <a href="https://www.graalvm.org/">GraalVM</a>. We will give each of these as examples below.</p>
        
        <h3 id="assembled-jar" class="section"><a class="anchor-link left" href="#assembled-jar"><i class="icofont-laika link">&#xef71;</i></a>Assembled JAR</h3>
        <p>As an example of building an assembled JAR we can use SBT with the <code>sbt-assembly</code> plugin. Simliar approaches should exist for other build tools. Consult their documentation. For SBT we find the plugin <a href="https://github.com/sbt/sbt-assembly">https://github.com/sbt/sbt-assembly</a>.</p>
        <p>For a simple project we should be able to add the sbt-assembly plugin to <code>project/plugins.sbt</code> and then run the <code>assembly</code> task. We might need to use a merge strategy if some of our dependencies have conflicting artifacts. Below is a simple example, but following the documentation will give more specific configuration examples.</p>
        <p>in project/plugins.sbt:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">addSbtPlugin</span><span>(</span><span class="string-literal">&quot;com.eed3si9n&quot;</span><span> % </span><span class="string-literal">&quot;sbt-assembly&quot;</span><span> % </span><span class="string-literal">&quot;sbt-assembly-version&quot;</span><span>)</span></code></pre>
        <p>Then as long as we have a <code>main</code> method in our project:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>sbt assembly</span></code></pre>
        <p>should build our &quot;fat&quot; assembly jar. We should see the path of the assembly from the sbt log. For example <code>target/scala-2.13/project-assembly-0.0.1-SNAPSHOT.jar</code></p>
        <p>Finally we can execute the jar with</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>java -jar /path.to/project-assembly-</span><span class="number-literal">0.0.1</span><span>-SNAPSHOT.jar</span></code></pre>
        <p>At this point you should see your http4s server start up. Regarding the artifact, it might be a good idea to place it inside a docker container or create a service script via a systemd unit or similar.</p>
        
        <h3 id="graal-native-image" class="section"><a class="anchor-link left" href="#graal-native-image"><i class="icofont-laika link">&#xef71;</i></a>Graal Native Image</h3>
        <p>We provide an outline for building a static native image below. Furthermore the <a href="https://github.com/http4s/http4s.g8">http4s giter8 template</a> can be used to build a native image in conjunction with this guide.</p>
        <p>Why would we create such an image? Some advantages might be faster startup times or less memory usage than the JVM.</p>
        
        <h4 id="install-graalvm-and-native-image-plugin" class="section"><a class="anchor-link left" href="#install-graalvm-and-native-image-plugin"><i class="icofont-laika link">&#xef71;</i></a>Install GraalVM and Native Image plugin</h4>
        <p>The first step is to install the core GraalVM and <code>native-image</code> plugin. The core GraalVM release might be thought of as a replacement for the JVM. The <code>native-image</code> plugin is required to create the binary. The <a href="https://github.com/graalvm/graalvm-ce-builds/releases">community edition builds</a> are free.</p>
        <p>After installing the core GraalVM you should be able to use it as a JDK. For example you might set <code>JAVA_HOME</code> to point to your Graal version. Otherwise, your build platform might allow you to select the Java library to build against Graal.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">export</span><span> JAVA_HOME=/path/to/graalVM</span></code></pre>
        <p>then</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>java --version</span></code></pre>
        <p>should return something like</p>
        <pre><code>openjdk 11.0.6 2020-01-14
OpenJDK Runtime Environment GraalVM CE 20.0.0 (build 11.0.6+9-jvmci-20.0-b02)
OpenJDK 64-Bit Server VM GraalVM CE 20.0.0 (build 11.0.6+9-jvmci-20.0-b02, mixed mode, sharing)</code></pre>
        
        <h3 id="optional-get-or-build-a-muslc-bundle-required-to-build-a-static-image" class="section"><a class="anchor-link left" href="#optional-get-or-build-a-muslc-bundle-required-to-build-a-static-image"><i class="icofont-laika link">&#xef71;</i></a>(Optional) Get or build a muslC bundle required to build a static image.</h3>
        <p>Note: Static images aren&#39;t supported in <a href="https://github.com/oracle/graal/issues/478">MacOS or Windows</a> . If building for those platforms skip this step</p>
        <p>To create a truly static native image we <a href="https://github.com/oracle/graal/issues/1919#issuecomment-589085506">need to use muslC</a> . Instructions and an example bundle are provided <a href="https://github.com/gradinac/musl-bundle-example">here</a>. For the sake of our example, we can download the resulting bundle for our build. We will need to use the path to the unpacked bundle as an argument to build the image.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>wget https://github.com/gradinac/musl-bundle-example/releases/download/v</span><span class="number-literal">1.0</span><span>/musl.tar.gz -O - | tar -xz</span></code></pre>
        
        <h3 id="meta-inf-resources-for-reflection" class="section"><a class="anchor-link left" href="#meta-inf-resources-for-reflection"><i class="icofont-laika link">&#xef71;</i></a>META-INF resources for reflection</h3>
        <p>We need META-INF resources whenever we use reflection. Reflection isn&#39;t used in http4s, though it is used by some logging implementations. We&#39;ve provided a native image example in the <a href="https://github.com/http4s/http4s.g8">http4s giter8 template</a></p>
        
        <h4 id="build-an-assembled-jar-using-graalvm" class="section"><a class="anchor-link left" href="#build-an-assembled-jar-using-graalvm"><i class="icofont-laika link">&#xef71;</i></a>Build an assembled jar using GraalVM</h4>
        <p>After installing the above dependencies you should build an assembled JAR. We can again use <code>sbt assembly</code> or your favorite build tool / plugin to create the assembled jar. The important thing is that we should be using the GraalVM version of Java to do so.</p>
        
        <h4 id="create-the-native-image-with-the-assembled-jar" class="section"><a class="anchor-link left" href="#create-the-native-image-with-the-assembled-jar"><i class="icofont-laika link">&#xef71;</i></a>Create the native image with the assembled JAR</h4>
        <p>After we have built the assembled JAR containing all our Java dependencies, we use that JAR to build our native image. In the command below we need to replace the muslC and assembly jar paths with the appropriate locations.</p>
        <p>Note: Mac and Windows platforms do not support build static images. Remove <code>--static</code> and <code>-H:UseMuslC=&quot;/path.to/muslC&quot;</code> when building for those platforms.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>native-image --static -H:+ReportExceptionStackTraces -H:UseMuslC=</span><span class="string-literal">&quot;/path.to/muslC&quot;</span><span> --allow-incomplete-classpath --no-fallback --initialize-at-build-</span><span class="keyword">time</span><span> --enable-http --enable-https --enable-all-security-services --verbose -jar </span><span class="string-literal">&quot;./path.to.assembly.jar&quot;</span><span> projectBinaryImage</span></code></pre>
        <p>A breakout for the command parameters (image generation options) :</p>
        <p><code>-H:UseMuslC</code> to fix DNS and related segfaults and build a true static image that doesn&#39;t depend on linked libraries.</p>
        <p><code>--initialize-at-build-time</code> again is related to building the static image. Again we lose performance if we instead do this at runtime.</p>
        <p><code>--enable-http</code>, <code>--enable-https</code> should correspond to related protocols</p>
        <p><code>--enable-all-security-services</code> will likely be required to make or receive https requests.</p>
        <p>Additional image generation options are found in the <a href="https://www.graalvm.org/docs/reference-manual/native-image/">native image reference</a></p>
        
        <h4 id="execute-the-native-image" class="section"><a class="anchor-link left" href="#execute-the-native-image"><i class="icofont-laika link">&#xef71;</i></a>Execute the native image</h4>
        <p>Finally we should be able to execute our output <code>projectBinaryImage</code></p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>./projectBinaryImage</span></code></pre>
        <p>At this point we may want to package the binary in a docker container, integrate the image generation to a greater build process, create init scripts via systemd, etc.</p>
        
        <h4 id="why-static" class="section"><a class="anchor-link left" href="#why-static"><i class="icofont-laika link">&#xef71;</i></a>Why static?</h4>
        <p>As an alternative to executing via the JVM, GraalVM&#39;s native-image allows us to execute as a native binary. For example, in Linux environments this might be known as an <code>ELF</code> format. There are a number of ways to generate a native image, be it dynamic or static.</p>
        <p>A dynamic image is less portable because it depends on shared library files on each Linux host. Then similar to creating an assembly JAR containing all our Java dependencies, when we build a static native image, we build
        a more portable assembly including all the dependencies to run our binary across multiple platforms. For example we could expect a static ELF-64 binary to work across multiple linux distributions of different versions for the same architecture.</p>

        
<hr class="footer-rule"/>
<footer>
  http4s is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>